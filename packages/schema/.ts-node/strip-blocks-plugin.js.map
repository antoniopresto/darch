{"version":3,"file":"strip-blocks-plugin.js","sourceRoot":"","sources":["../src/strip-blocks-plugin.ts"],"names":[],"mappings":";;AAEA,SAAwB,iBAAiB;IACvC,OAAO;QACL,IAAI,EAAE,uBAAuB;QAE7B,OAAO,EAAE;YACP,OAAO,EAAP,UAAQ,IAAI,EAAE,UAAU;gBACd,IAAA,KAA2B,UAAU,CAAC,IAAW,aAA3B,EAAtB,YAAY,mBAAG,OAAO,KAAA,CAA4B;gBAE1D,SAAS,MAAM,CAAC,OAA2B;;oBACzC,OAAO,CAAC,CAAA,MAAA,OAAO,CAAC,KAAK,0CAAE,IAAI,GAAG,UAAU,CAAC,YAAY,CAAC,CAAA,CAAC;gBACzD,CAAC;gBAED,IAAI,CAAC,QAAQ,CAAC;oBACZ,KAAK,YAAC,IAAI;wBACR,IAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,EAAE,CAAC;wBACjD,IAAI,CAAC,QAAQ,CAAC,MAAM;4BAAE,OAAO;wBAC7B,IAAM,IAAI,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;wBACxD,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC;4BAAE,OAAO;wBAC3C,IAAI,CAAC,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;wBAC/B,IAAI,CAAC,MAAM,EAAE,CAAC;oBAChB,CAAC;oBACD,IAAI,YAAC,IAAI;;wBACP,IAAI,CAAC,IAAI,CAAC,gBAAgB;4BACxB,CAAA,MAAA,IAAI,CAAC,IAAI,CAAC,gBAAgB,0CAAE,MAAM,CAAC,MAAM,CAAC,KAAI,IAAI,CAAC;wBACrD,IAAI,CAAC,IAAI,CAAC,aAAa;4BACrB,CAAA,MAAA,IAAI,CAAC,IAAI,CAAC,aAAa,0CAAE,MAAM,CAAC,MAAM,CAAC,KAAI,IAAI,CAAC;wBAClD,IAAI,CAAC,IAAI,CAAC,eAAe;4BACvB,CAAA,MAAA,IAAI,CAAC,IAAI,CAAC,eAAe,0CAAE,MAAM,CAAC,MAAM,CAAC,KAAI,IAAI,CAAC;oBACtD,CAAC;iBACF,CAAC,CAAC;YACL,CAAC;SACF;KACF,CAAC;AACJ,CAAC;AAjCD,oCAiCC","sourcesContent":["import { PluginObj } from '@babel/core';\n\nexport default function StripBlocksPlugin(): PluginObj {\n  return {\n    name: 'transform-strip-block',\n\n    visitor: {\n      Program(path, pluginPass) {\n        const { magicComment = '@only' } = pluginPass.opts as any;\n\n        function remove(comment: { value?: string }) {\n          return !comment.value?.trim().startsWith(magicComment);\n        }\n\n        path.traverse({\n          enter(path) {\n            const comments = path.node.leadingComments || [];\n            if (!comments.length) return;\n            const text = comments[comments.length - 1].value.trim();\n            if (!text.startsWith(magicComment)) return;\n            path.node.leadingComments = [];\n            path.remove();\n          },\n          exit(path) {\n            path.node.trailingComments =\n              path.node.trailingComments?.filter(remove) || null;\n            path.node.innerComments =\n              path.node.innerComments?.filter(remove) || null;\n            path.node.leadingComments =\n              path.node.leadingComments?.filter(remove) || null;\n          },\n        });\n      },\n    },\n  };\n}\n"]}